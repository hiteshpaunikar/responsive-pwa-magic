<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Doctor List - ISRO SAC</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
    <div class="container py-4">
      <h1 class="mb-4">Doctor List</h1>
      
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="input-group">
            <input type="text" id="searchInput" class="form-control" placeholder="Search doctors...">
            <button id="voiceSearchBtn" class="btn btn-outline-secondary">
              <i class="bi bi-mic"></i>
            </button>
          </div>
        </div>
        <div class="col-md-6">
          <select id="filterSelect" class="form-select">
            <option value="all">Search All Fields</option>
            <option value="AMODOCTORNAME">Doctor Name</option>
            <option value="DOCTORTYPE">Doctor Type</option>
            <option value="MEDICINETYPE">Medicine Type</option>
          </select>
        </div>
      </div>

      <div id="doctorsList" class="row row-cols-1 row-cols-md-2 g-4">
        <!-- Doctors will be rendered here -->
      </div>
    </div>

    <!-- Add Lovable script before other scripts -->
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script type="module">
      import { doctorsData } from '/src/data/doctors.js';
      
      let doctors = doctorsData.Doctor;
      let recognition = null;

      // Initialize speech recognition
      if ('webkitSpeechRecognition' in window) {
        recognition = new webkitSpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'en-US';

        recognition.onresult = function(event) {
          const transcript = event.results[0][0].transcript;
          document.getElementById('searchInput').value = transcript;
          filterDoctors();
          voiceSearchBtn.classList.remove('listening');
        };

        recognition.onerror = function(event) {
          console.error('Speech recognition error:', event.error);
          voiceSearchBtn.classList.remove('listening');
        };
      }

      // Voice search button handler
      const voiceSearchBtn = document.getElementById('voiceSearchBtn');
      voiceSearchBtn.addEventListener('click', () => {
        if (recognition) {
          recognition.start();
          voiceSearchBtn.classList.add('listening');
        } else {
          alert('Speech recognition is not supported in your browser.');
        }
      });

      function renderDoctors(doctorsToRender) {
        const doctorsList = document.getElementById('doctorsList');
        if (doctorsToRender.length === 0) {
          doctorsList.innerHTML = `
            <div class="alert alert-info" role="alert">
              No doctors found matching your search criteria.
            </div>
          `;
          return;
        }

        doctorsList.innerHTML = doctorsToRender.map(doctor => `
          <div class="card">
            <div class="card-body">
              <h3 class="h5 mb-2">${doctor.AMODOCTORNAME || 'N/A'}</h3>
              <p class="mb-1"><strong>Type:</strong> ${doctor.DOCTORTYPE || 'N/A'}</p>
              <p class="mb-1"><strong>Medicine:</strong> ${doctor.MEDICINETYPE || 'N/A'}</p>
              <p class="mb-1"><strong>Timings:</strong> ${doctor.AMOTIMINGS || 'N/A'}</p>
              <p class="mb-1"><strong>Phone:</strong> ${doctor.AMOPHONENO || 'N/A'}</p>
              <p class="mb-0"><strong>Address:</strong> ${[doctor.AMOHOUSENO, doctor.AMOSTREET, doctor.AMOPLACE].filter(Boolean).join(', ') || 'N/A'}</p>
            </div>
          </div>
        `).join('');
      }

      function filterDoctors() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const filterType = document.getElementById('filterSelect').value;
        
        const filtered = doctors.filter(doctor => {
          if (filterType === 'all') {
            return Object.values(doctor).some(value => 
              value && value.toLowerCase().includes(searchTerm)
            );
          }
          return doctor[filterType] && 
                 doctor[filterType].toLowerCase().includes(searchTerm);
        });
        
        renderDoctors(filtered);
      }

      // Event listeners
      document.getElementById('searchInput').addEventListener('input', filterDoctors);
      document.getElementById('filterSelect').addEventListener('change', filterDoctors);

      // Initial render
      renderDoctors(doctors);
    </script>
  </body>
</html>
